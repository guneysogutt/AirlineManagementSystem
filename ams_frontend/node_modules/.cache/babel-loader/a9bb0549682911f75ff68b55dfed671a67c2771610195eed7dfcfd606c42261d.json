{"ast":null,"code":"var _jsxFileName = \"/Users/guneysogut/guney/projects/AMS/ams/src/routes/Booking.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$(),\n  _s5 = $RefreshSig$();\nimport { createContext, useContext, useMemo, useState } from \"react\";\nimport { useLoaderData, useRouteError } from 'react-router-dom';\nimport { chunk, isEqual } from 'underscore';\nimport { useImmer } from 'use-immer';\nimport { axios } from '../index';\nimport dayjs from \"dayjs\";\nimport { Box, Button, Divider, Stack, Step, StepButton, Stepper, Typography, Grid } from \"@mui/material\";\nimport { ArrowRight, ErrorOutline, CheckCircleOutline, WarningAmber } from '@mui/icons-material';\nimport Page from \"../components/Page\";\nimport PassengerForm from '../components/PassengerForm';\nimport { SeatDescription, SeatPlan, seatToAlphaIndex, seatToIndex } from '../components/Seat';\nimport Error from '../components/Error';\nimport { Center } from '../components/Styled';\nimport { FlightDetails, getPrice } from \"../components/Flight\";\nimport { LoadingButton } from \"@mui/lab\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const BookingContext = /*#__PURE__*/createContext({});\nconst NUMBER_OF_SEATS = 270;\nconst steps = [/*#__PURE__*/_jsxDEV(PassengerForm, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 24,\n  columnNumber: 3\n}, this), /*#__PURE__*/_jsxDEV(SeatSelection, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 25,\n  columnNumber: 3\n}, this), /*#__PURE__*/_jsxDEV(Payment, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 26,\n  columnNumber: 3\n}, this)];\nexport function Booking() {\n  _s();\n  const {\n    flight,\n    occupation,\n    plan\n  } = useLoaderData();\n  const [step, setStep] = useState(0);\n  const [booking, updateBooking] = useImmer({\n    flight_number: flight.flight_number,\n    ticket_type: plan,\n    national_id: '',\n    name: '',\n    surname: '',\n    email: '',\n    phone: '',\n    gender: 'Male',\n    disabled: 0,\n    seat: null,\n    birth_date: null\n  });\n  const nextStep = () => setStep(step + 1);\n  const seats = useMemo(() => {\n    const seats = Array(NUMBER_OF_SEATS).fill(false);\n    occupation.forEach(seat => seats[seat] = true);\n    return chunk(chunk(seats, 3), 3);\n  }, [occupation]);\n  const context = {\n    step,\n    setStep,\n    nextStep,\n    booking,\n    updateBooking,\n    seats,\n    flight\n  };\n  return /*#__PURE__*/_jsxDEV(BookingContext.Provider, {\n    value: context,\n    children: /*#__PURE__*/_jsxDEV(Page, {\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        padding: 2,\n        display: \"flex\",\n        justifyContent: \"center\",\n        children: /*#__PURE__*/_jsxDEV(Stack, {\n          sx: {\n            width: '900px'\n          },\n          spacing: 3,\n          alignItems: \"stretch\",\n          children: [/*#__PURE__*/_jsxDEV(FlightDetails, {\n            from: flight.departure_airport,\n            to: flight.destination_airport,\n            date: flight.departure_time\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 61,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Steps, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 67,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Stack, {\n            alignItems: \"center\",\n            children: steps[step]\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n}\n_s(Booking, \"YlEQ1EPI1H3rZtWo0uZtaXN0rGI=\", false, function () {\n  return [useLoaderData, useImmer];\n});\n_c = Booking;\nexport function BookingErrorBoundary() {\n  _s2();\n  const error = useRouteError();\n  return /*#__PURE__*/_jsxDEV(Page, {\n    children: /*#__PURE__*/_jsxDEV(Center, {\n      children: error.response ? /*#__PURE__*/_jsxDEV(Error, {\n        title: \"Flight not found\",\n        children: \"A scheduled flight can not be found or your ticket type is invalid.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 15\n      }, this) : /*#__PURE__*/_jsxDEV(Error, {\n        title: \"Something went wrong\",\n        children: \"It appears that a network error has occurred.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n}\n_s2(BookingErrorBoundary, \"oAgjgbJzsRXlB89+MoVumxMQqKM=\", false, function () {\n  return [useRouteError];\n});\n_c2 = BookingErrorBoundary;\nexport async function bookingLoader({\n  params: {\n    flight_number,\n    plan\n  }\n}) {\n  const [{\n    data: [flight]\n  }, {\n    data: occupation\n  }] = await Promise.all([axios.get(`/flight/${flight_number}`), axios.get(`/flight/seats?id=${flight_number}`)]);\n  if (![\"Essentials\", \"Advantage\", \"comfort\"].includes(plan)) throw new Error(`Invalid ticket type \"${plan}\"`);\n  return {\n    flight,\n    occupation,\n    plan\n  };\n}\nfunction SeatSelection() {\n  _s3();\n  const {\n    nextStep,\n    updateBooking,\n    seats\n  } = useContext(BookingContext);\n  const [selectedSeat, setSelectedSeat] = useState(null);\n  const handleSubmit = () => {\n    updateBooking(draft => {\n      draft.seat = selectedSeat;\n    });\n    nextStep();\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Stack, {\n      direction: \"row\",\n      spacing: 5,\n      children: [/*#__PURE__*/_jsxDEV(Stack, {\n        spacing: 2,\n        direction: \"row\",\n        alignItems: \"center\",\n        divider: /*#__PURE__*/_jsxDEV(Divider, {\n          orientation: \"vertical\",\n          flexItem: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 73\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(SeatDescription, {\n          variant: \"occupied\",\n          label: \"Occupied\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SeatDescription, {\n          variant: \"vacant\",\n          label: \"Vacant\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SeatDescription, {\n          variant: \"selected\",\n          label: \"Selected\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        sx: {\n          width: '150px'\n        },\n        disabled: selectedSeat === null,\n        variant: \"contained\",\n        endIcon: /*#__PURE__*/_jsxDEV(ArrowRight, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 20\n        }, this),\n        onClick: handleSubmit,\n        children: \"Continue\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SeatPlan, {\n      plan: seats,\n      isSelected: seat => isEqual(seat, selectedSeat),\n      onSelect: setSelectedSeat\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s3(SeatSelection, \"Fz5rTzG4fy7w7PG4W921gJCrCeI=\");\n_c3 = SeatSelection;\nfunction Steps() {\n  _s4();\n  const {\n    step,\n    setStep\n  } = useContext(BookingContext);\n  return /*#__PURE__*/_jsxDEV(Stepper, {\n    alternativeLabel: true,\n    activeStep: step,\n    children: [/*#__PURE__*/_jsxDEV(Step, {\n      children: /*#__PURE__*/_jsxDEV(StepButton, {\n        onClick: () => setStep(0),\n        children: \"Passenger information\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Step, {\n      children: /*#__PURE__*/_jsxDEV(StepButton, {\n        onClick: () => setStep(1),\n        children: \"Seat selection\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Step, {\n      children: /*#__PURE__*/_jsxDEV(StepButton, {\n        onClick: () => setStep(2),\n        children: \"Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 152,\n    columnNumber: 5\n  }, this);\n}\n_s4(Steps, \"djJKrL5wwoqHxKZHcPHNz3Iyd7c=\");\n_c4 = Steps;\nconst Detail = ({\n  label,\n  children\n}) => /*#__PURE__*/_jsxDEV(Typography, {\n  children: [\" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n    children: label\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 173,\n    columnNumber: 16\n  }, this), \": \", children]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 173,\n  columnNumber: 3\n}, this);\n_c5 = Detail;\nconst Status = ({\n  Icon,\n  children\n}) => /*#__PURE__*/_jsxDEV(Stack, {\n  sx: {\n    minHeight: '200px'\n  },\n  alignItems: \"center\",\n  children: [/*#__PURE__*/_jsxDEV(Icon, {\n    sx: {\n      fontSize: '100px',\n      color: 'grey.500',\n      mb: 1\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 5\n  }, this), children]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 176,\n  columnNumber: 3\n}, this);\n_c6 = Status;\nfunction Payment() {\n  _s5();\n  const {\n    booking,\n    flight\n  } = useContext(BookingContext);\n  const [pnr, setPnr] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [status, setStatus] = useState(null);\n  const [failMessage, setFailMessage] = useState('');\n  const handleClick = () => {\n    const payload = {\n      ...booking,\n      birth_date: dayjs(booking.birth_date).format(\"YYYY-MM-DD\"),\n      seat: seatToIndex(booking.seat).toString(),\n      child: Number(dayjs().diff(booking.birth_date, 'year', true) < 10).toString(),\n      disabled: booking.disabled.toString()\n    };\n    setLoading(true);\n    axios.post('/ticket/payment', payload).then(({\n      data: {\n        pnr\n      }\n    }) => {\n      setPnr(pnr);\n      setStatus('success');\n    }).catch(error => {\n      if (error.response) {\n        setStatus('fail');\n        setFailMessage(error.response.data);\n      } else {\n        setStatus('error');\n      }\n    }).finally(() => setLoading(false));\n  };\n  if (status) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      children: [status === \"fail\" && /*#__PURE__*/_jsxDEV(Status, {\n        Icon: ErrorOutline,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          children: \"Payment failed.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"caption\",\n          children: [\"Status: \", failMessage]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 11\n      }, this), status === \"error\" && /*#__PURE__*/_jsxDEV(Status, {\n        Icon: WarningAmber,\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          children: \"Something went wrong.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }, this), status === \"success\" && /*#__PURE__*/_jsxDEV(Status, {\n        Icon: CheckCircleOutline,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          children: [\"Your reservation number is: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [\" \", pnr, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          sx: {\n            mt: 1\n          },\n          href: `/checkin/${pnr}/${booking.surname}`,\n          variant: \"contained\",\n          children: \"See check-in details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(Stack, {\n      alignSelf: \"stretch\",\n      spacing: 4,\n      alignItems: \"center\",\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        fontWeight: \"bold\",\n        variant: \"h5\",\n        children: \"Overview of your booking details\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Stack, {\n        alignSelf: \"stretch\",\n        direction: \"row\",\n        justifyContent: \"space-evenly\",\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            children: \" Passenger \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Divider, {\n            sx: {\n              my: .5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Fullname\",\n            children: booking.name + \" \" + booking.surname\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"National ID\",\n            children: booking.national_id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Phone\",\n            children: booking.phone\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Email\",\n            children: booking.email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Disabled\",\n            children: booking.disabled ? \"Yes\" : \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            children: \" Flight \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Divider, {\n            sx: {\n              my: .5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"From\",\n            children: flight.departure_airport\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"To\",\n            children: flight.destination_airport\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Date\",\n            children: dayjs(flight.departure_time).format(\"L LT\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Ticket type\",\n            children: booking.ticket_type\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Detail, {\n            label: \"Seat\",\n            children: seatToAlphaIndex(booking.seat)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        children: [\"Total price: \", getPrice(flight.price, booking.ticket_type), \" \\u20BA\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(LoadingButton, {\n        loading: loading,\n        variant: \"contained\",\n        onClick: handleClick,\n        children: \"Purchase\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this);\n  }\n}\n_s5(Payment, \"qogWzzMR7curS6kTLEwzxMmc/Uw=\");\n_c7 = Payment;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"Booking\");\n$RefreshReg$(_c2, \"BookingErrorBoundary\");\n$RefreshReg$(_c3, \"SeatSelection\");\n$RefreshReg$(_c4, \"Steps\");\n$RefreshReg$(_c5, \"Detail\");\n$RefreshReg$(_c6, \"Status\");\n$RefreshReg$(_c7, \"Payment\");","map":{"version":3,"names":["createContext","useContext","useMemo","useState","useLoaderData","useRouteError","chunk","isEqual","useImmer","axios","dayjs","Box","Button","Divider","Stack","Step","StepButton","Stepper","Typography","Grid","ArrowRight","ErrorOutline","CheckCircleOutline","WarningAmber","Page","PassengerForm","SeatDescription","SeatPlan","seatToAlphaIndex","seatToIndex","Error","Center","FlightDetails","getPrice","LoadingButton","jsxDEV","_jsxDEV","Fragment","_Fragment","BookingContext","NUMBER_OF_SEATS","steps","fileName","_jsxFileName","lineNumber","columnNumber","SeatSelection","Payment","Booking","_s","flight","occupation","plan","step","setStep","booking","updateBooking","flight_number","ticket_type","national_id","name","surname","email","phone","gender","disabled","seat","birth_date","nextStep","seats","Array","fill","forEach","context","Provider","value","children","padding","display","justifyContent","sx","width","spacing","alignItems","from","departure_airport","to","destination_airport","date","departure_time","Steps","_c","BookingErrorBoundary","_s2","error","response","title","_c2","bookingLoader","params","data","Promise","all","get","includes","_s3","selectedSeat","setSelectedSeat","handleSubmit","draft","direction","divider","orientation","flexItem","variant","label","endIcon","onClick","isSelected","onSelect","_c3","_s4","alternativeLabel","activeStep","_c4","Detail","_c5","Status","Icon","minHeight","fontSize","color","mb","_c6","_s5","pnr","setPnr","loading","setLoading","status","setStatus","failMessage","setFailMessage","handleClick","payload","format","toString","child","Number","diff","post","then","catch","finally","mt","href","alignSelf","fontWeight","my","price","_c7","$RefreshReg$"],"sources":["/Users/guneysogut/guney/projects/AMS/ams/src/routes/Booking.js"],"sourcesContent":["import { createContext, useContext, useMemo, useState } from \"react\";\nimport { useLoaderData, useRouteError } from 'react-router-dom';\nimport { chunk, isEqual } from 'underscore';\nimport { useImmer } from 'use-immer';\nimport { axios } from '../index';\nimport dayjs from \"dayjs\";\n\nimport { Box, Button, Divider, Stack, Step, StepButton, Stepper, Typography, Grid } from \"@mui/material\";\nimport { ArrowRight, ErrorOutline, CheckCircleOutline, WarningAmber } from '@mui/icons-material';\n\nimport Page from \"../components/Page\";\nimport PassengerForm from '../components/PassengerForm';\nimport { SeatDescription, SeatPlan, seatToAlphaIndex, seatToIndex } from '../components/Seat';\nimport Error from '../components/Error';\nimport { Center } from '../components/Styled';\nimport { FlightDetails, getPrice } from \"../components/Flight\";\nimport { LoadingButton } from \"@mui/lab\";\n\nexport const BookingContext = createContext({});\n\nconst NUMBER_OF_SEATS = 270;\n\nconst steps = [\n  <PassengerForm />,\n  <SeatSelection />,\n  <Payment />\n];\n\nexport function Booking() {\n  const { flight, occupation, plan } = useLoaderData();\n  const [step, setStep] = useState(0);\n  const [booking, updateBooking] = useImmer({\n    flight_number: flight.flight_number,\n    ticket_type: plan,\n    national_id: '',\n    name: '',\n    surname: '',\n    email: '',\n    phone: '',\n    gender: 'Male',\n    disabled: 0,\n    seat: null,\n    birth_date: null,\n  });\n\n  const nextStep = () => setStep(step + 1)\n\n  const seats = useMemo(() => {\n    const seats = Array(NUMBER_OF_SEATS).fill(false);\n    occupation.forEach(seat => seats[seat] = true);\n    return chunk(chunk(seats, 3), 3);\n  }, [occupation]);\n\n  const context = { step, setStep, nextStep, booking, updateBooking, seats, flight };\n\n  return (\n    <BookingContext.Provider value={context}>\n      <Page>\n        <Box padding={2} display='flex' justifyContent='center'>\n          <Stack sx={{ width: '900px' }} spacing={3} alignItems='stretch'>\n            <FlightDetails\n              from={flight.departure_airport}\n              to={flight.destination_airport}\n              date={flight.departure_time}\n            />\n\n            <Steps />\n\n            <Stack alignItems='center'>\n              {steps[step]}\n            </Stack>\n          </Stack >\n        </Box >\n      </Page>\n    </BookingContext.Provider>\n  );\n}\n\nexport function BookingErrorBoundary() {\n  const error = useRouteError();\n\n  return (\n    <Page>\n      <Center>\n        {\n          error.response\n            ? <Error title=\"Flight not found\">A scheduled flight can not be found or your ticket type is invalid.</Error>\n            : <Error title=\"Something went wrong\">It appears that a network error has occurred.</Error>\n        }\n      </Center >\n    </Page>\n  );\n}\n\nexport async function bookingLoader({ params: { flight_number, plan } }) {\n  const [{ data: [flight] }, { data: occupation }] = await Promise.all([\n    axios.get(`/flight/${flight_number}`),\n    axios.get(`/flight/seats?id=${flight_number}`),\n  ]);\n\n  if (![\"Essentials\", \"Advantage\", \"comfort\"].includes(plan))\n    throw new Error(`Invalid ticket type \"${plan}\"`);\n\n  return { flight, occupation, plan };\n}\n\nfunction SeatSelection() {\n  const { nextStep, updateBooking, seats } = useContext(BookingContext);\n  const [selectedSeat, setSelectedSeat] = useState(null);\n\n  const handleSubmit = () => {\n    updateBooking(draft => {\n      draft.seat = selectedSeat;\n    });\n\n    nextStep();\n  }\n\n  return (\n    <>\n      <Stack direction='row' spacing={5}>\n        <Stack spacing={2} direction='row' alignItems='center' divider={<Divider orientation=\"vertical\" flexItem />}>\n          <SeatDescription variant=\"occupied\" label=\"Occupied\" />\n          <SeatDescription variant=\"vacant\" label=\"Vacant\" />\n          <SeatDescription variant=\"selected\" label=\"Selected\" />\n        </Stack>\n\n        <Button\n          sx={{ width: '150px' }}\n          disabled={selectedSeat === null}\n          variant='contained'\n          endIcon={<ArrowRight />}\n          onClick={handleSubmit}\n        >\n          Continue\n        </Button>\n      </Stack>\n\n      <SeatPlan\n        plan={seats}\n        isSelected={seat => isEqual(seat, selectedSeat)}\n        onSelect={setSelectedSeat}\n      />\n    </>\n  );\n}\n\nfunction Steps() {\n  const { step, setStep } = useContext(BookingContext);\n\n  return (\n    <Stepper alternativeLabel activeStep={step}>\n      <Step>\n        <StepButton onClick={() => setStep(0)}>\n          Passenger information\n        </StepButton>\n      </Step>\n      <Step>\n        <StepButton onClick={() => setStep(1)}>\n          Seat selection\n        </StepButton>\n      </Step>\n      <Step>\n        <StepButton onClick={() => setStep(2)}>\n          Payment\n        </StepButton>\n      </Step>\n    </Stepper>\n  )\n}\n\nconst Detail = ({ label, children }) =>\n  <Typography> <strong>{label}</strong>: {children}</Typography>;\n\nconst Status = ({ Icon, children }) => (\n  <Stack sx={{ minHeight: '200px' }} alignItems='center'>\n    <Icon sx={{ fontSize: '100px', color: 'grey.500', mb: 1 }} />\n    {children}\n  </Stack>\n);\n\nfunction Payment() {\n  const { booking, flight } = useContext(BookingContext);\n\n  const [pnr, setPnr] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [status, setStatus] = useState(null);\n  const [failMessage, setFailMessage] = useState('');\n\n  const handleClick = () => {\n    const payload = {\n      ...booking,\n      birth_date: dayjs(booking.birth_date).format(\"YYYY-MM-DD\"),\n      seat: seatToIndex(booking.seat).toString(),\n      child: Number(dayjs().diff(booking.birth_date, 'year', true) < 10).toString(),\n      disabled: booking.disabled.toString(),\n    }\n\n    setLoading(true);\n\n    axios.post('/ticket/payment', payload)\n      .then(({ data: { pnr } }) => {\n        setPnr(pnr);\n        setStatus('success');\n      })\n      .catch(error => {\n        if (error.response) {\n          setStatus('fail');\n          setFailMessage(error.response.data);\n        } else {\n          setStatus('error');\n        }\n      })\n      .finally(() => setLoading(false));\n  }\n\n  if (status) {\n    return (\n      <Box>\n        {\n          status === \"fail\" &&\n          <Status Icon={ErrorOutline}>\n            <Typography>\n              Payment failed.\n            </Typography>\n            <Typography variant='caption'>\n              Status: {failMessage}\n            </Typography>\n          </Status>\n        }\n\n        {\n          status === \"error\" &&\n          <Status Icon={WarningAmber}>\n            <Typography>\n              Something went wrong.\n            </Typography>\n          </Status>\n        }\n\n        {\n          status === \"success\" &&\n          <Status Icon={CheckCircleOutline}>\n            <Typography>\n              Your reservation number is: <strong> {pnr} </strong>\n            </Typography>\n            <Button sx={{ mt: 1 }} href={`/checkin/${pnr}/${booking.surname}`} variant=\"contained\">\n              See check-in details\n            </Button>\n          </Status>\n        }\n      </Box>\n    );\n  } else {\n    return (\n      <Stack alignSelf='stretch' spacing={4} alignItems='center'>\n        <Typography fontWeight='bold' variant='h5'>\n          Overview of your booking details\n        </Typography>\n\n        <Stack alignSelf='stretch' direction='row' justifyContent='space-evenly' >\n          <Box>\n            <Typography variant='h6'> Passenger </Typography>\n            <Divider sx={{ my: .5 }} />\n            <Detail label=\"Fullname\">{booking.name + \" \" + booking.surname}</Detail>\n            <Detail label=\"National ID\">{booking.national_id}</Detail>\n            <Detail label=\"Phone\">{booking.phone}</Detail>\n            <Detail label=\"Email\">{booking.email}</Detail>\n            <Detail label=\"Disabled\">{booking.disabled ? \"Yes\" : \"No\"}</Detail>\n          </Box>\n          <Box>\n            <Typography variant='h6'> Flight </Typography>\n            <Divider sx={{ my: .5 }} />\n            <Detail label=\"From\">{flight.departure_airport}</Detail>\n            <Detail label=\"To\">{flight.destination_airport}</Detail>\n            <Detail label=\"Date\">{dayjs(flight.departure_time).format(\"L LT\")}</Detail>\n            <Detail label=\"Ticket type\">{booking.ticket_type}</Detail>\n            <Detail label=\"Seat\">{seatToAlphaIndex(booking.seat)}</Detail>\n          </Box>\n        </Stack>\n\n        <Typography variant='h6'>\n          Total price: {getPrice(flight.price, booking.ticket_type)} â‚º\n        </Typography>\n\n        <LoadingButton loading={loading} variant=\"contained\" onClick={handleClick}>\n          Purchase\n        </LoadingButton>\n      </Stack>\n    );\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}